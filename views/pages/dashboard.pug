extends ../layout
block content
  style. 
    .notify {
      width: 100%;
      padding: 10px;
      border: 1px solid #000;
      margin: 10px;
    }

    .notify.read {
      background-color: rgba(0, 255, 0, 0.5);
    }

    .notify.unread {
      background-color: rgba(255, 0, 0, 0.5);
    }

  div(style="display: flex; justify-content: flex-start; align-items: center;")
    img(src=user.avatar, alt=user.name, style="width: 100px; height: 100px; border-radius: 50%; margin: 10px;")
    div 
      h3 Olá, #{user.name} - #{user.username}
      p #{user.email}
  div 
    p Econtrar um usuário
    input(type="text", name="username", id="username")
  div(class="notifies")
    if !notifies.notifies.length
      p Nenhuma notificação
    else
      each notify in notifies.notifies
        div(class=`notify ${notify.status ? 'read' : 'unread'}`, data-id=notify.id)
          if !notify.status 
            button(class="read", onclick=`markAsRead('${notify.id}')`) Marcar como lida
          p !{notify.title}
          p !{notify.content}
          p !{notify.by}
          p #{new Date(notify.createdAt).toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo', month: 'long', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' })}


  script.

    function markAsRead(id) {
      fetch(`/users/notify/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          status: true
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status) {
          const notify = document.querySelector(`[data-id="${id}"]`);
          notify.classList.remove('unread');
          notify.classList.add('read');
        }
      })
    }